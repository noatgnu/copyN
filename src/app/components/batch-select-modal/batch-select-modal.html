<div class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="onBackdropClick($event)">
  <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
    <div class="modal-header flex items-center justify-between p-4 border-b">
      <h2 class="text-lg font-semibold">Batch Select</h2>
      <button type="button" class="text-gray-500 hover:text-gray-700" (click)="onClose()">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="search-mode-toggle flex items-center gap-4 px-4 py-2 bg-gray-50 border-b">
      <span class="text-sm text-gray-600">Search by:</span>
      <label class="flex items-center gap-1 cursor-pointer">
        <input
          type="radio"
          name="searchMode"
          [checked]="searchMode() === 'gene'"
          (change)="setSearchMode('gene')"
          class="h-3 w-3" />
        <span class="text-sm">Gene Name</span>
      </label>
      <label class="flex items-center gap-1 cursor-pointer">
        <input
          type="radio"
          name="searchMode"
          [checked]="searchMode() === 'accession'"
          (change)="setSearchMode('accession')"
          class="h-3 w-3" />
        <span class="text-sm">Accession ID</span>
      </label>
    </div>

    <div class="tabs flex border-b">
      <button
        type="button"
        class="px-4 py-2 font-medium"
        [class.text-blue-600]="activeTab() === 'lists'"
        [class.border-b-2]="activeTab() === 'lists'"
        [class.border-blue-600]="activeTab() === 'lists'"
        [class.text-gray-500]="activeTab() !== 'lists'"
        (click)="setActiveTab('lists')">
        Filter Lists
      </button>
      <button
        type="button"
        class="px-4 py-2 font-medium"
        [class.text-blue-600]="activeTab() === 'custom'"
        [class.border-b-2]="activeTab() === 'custom'"
        [class.border-blue-600]="activeTab() === 'custom'"
        [class.text-gray-500]="activeTab() !== 'custom'"
        (click)="setActiveTab('custom')">
        Custom List
      </button>
    </div>

    <div class="modal-body flex-1 overflow-auto p-4">
      @if (activeTab() === 'lists') {
        <div class="search-controls flex gap-2 mb-4">
          <select
            class="px-3 py-2 border rounded text-sm"
            [value]="selectedCategory()"
            (change)="onCategoryChange($event)">
            <option value="">All Categories</option>
            @for (cat of categories(); track cat) {
              <option [value]="cat">{{ cat }}</option>
            }
          </select>
          <input
            type="text"
            class="flex-1 px-3 py-2 border rounded text-sm"
            placeholder="Search by name..."
            [value]="searchQuery()"
            (input)="onSearchInput($event)"
            (keyup.enter)="onSearchSubmit()" />
          <button
            type="button"
            class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
            (click)="onSearchSubmit()">
            Search
          </button>
        </div>

        @if (loading()) {
          <div class="text-center py-8 text-gray-500">Loading...</div>
        } @else if (error()) {
          <div class="text-center py-8 text-red-500">{{ error() }}</div>
        } @else if (filteredLists().length === 0) {
          <div class="text-center py-8 text-gray-500">No filter lists found</div>
        } @else {
          <div class="filter-lists space-y-2">
            @for (list of filteredLists(); track list.id) {
              <div
                class="list-item p-3 border rounded cursor-pointer hover:bg-gray-50"
                (click)="selectFilterList(list)">
                <div class="font-medium text-sm">{{ list.name }}</div>
                <div class="text-xs text-gray-500">{{ list.category }}</div>
              </div>
            }
          </div>
        }
      }

      @if (activeTab() === 'custom') {
        <div class="custom-input">
          <label class="block text-sm font-medium mb-2">
            @if (searchMode() === 'gene') {
              Enter gene names (one per line or comma/space separated)
            } @else {
              Enter accession IDs (one per line or comma/space separated)
            }
          </label>
          <textarea
            class="w-full h-48 px-3 py-2 border rounded text-sm font-mono"
            [placeholder]="searchMode() === 'gene' ? 'GAPDH\nACTB\nTP53' : 'P04406\nP60709\nP04637'"
            [value]="customList()"
            (input)="onCustomListInput($event)">
          </textarea>
          <button
            type="button"
            class="mt-4 px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
            (click)="applyCustomList()">
            Apply Custom List
          </button>
        </div>
      }
    </div>
  </div>
</div>
